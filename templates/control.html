<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
  <script type="text/javascript" src="{{option.jquery}}"></script>
  <script type="text/javascript">
  var socket = io.connect('http://'+document.domain + ':' + location.port);
  socket.on('connect', function() {
    console.log('socket connected');
  })

  var userImages = [];
  var userScores = [];
  function send(val, target) {
    if (target) {
      //target.innerText += ' 전송중...';
    }
    socket.emit('control message', val);
    /*$.ajax({
      url: '/pf-message/'+val,
      success: function(data) {
        console.log(data);
      },
    });*/
  }

  function getTags(target) {
    target.innerText += ' 전송중...';
    $.ajax({    
      url: '/pf-get-tags/' + userImages[parseInt($('#tagNumber').val())],
      success: function(data) {
        if (data.r == 's') {
          $('#tagsText').val(data.t.join(' '));
          $('#captionText').val(data.c);
	      } else {
          $('#tagsText').val('에러');
	      }
        target.innerText = target.innerText.split(' 전송중...')[0];
      }
    });
  }

  function updateImages(target) {
    target.innerText += ' 전송중...';
    $.ajax({    
      url: '/pf-update-image',
      success: function(data) {
        if (data.r == 's') {
          var d = document.getElementById('imagesDiv');
          while(d.children.length > 0) {
            d.removeChild(d.children[0]);
          }
          userImages = [];
          userScores = [];
          for (var i = 0; i < data.f.length; i++) {
            var htmlImage = new Image();
            htmlImage.style.maxWidth = '100px';
            htmlImage.style.maxHeight = '100px';
            htmlImage.src = '{{option.imageoriginal}}' + data.f[i];
            d.appendChild(htmlImage);
            userImages.push(data.f[i]);
            userScores.push(data.s[i]);
          }
        }
        target.innerText = target.innerText.split(' 전송중...')[0];
      }
    })
  }

  function w2w(target) {
    target.innerText += ' 전송중...';
    $.ajax({
      url: '/pf-w2w/'+encodeURIComponent($('#w2winput').val()),
      success: function(data) {
        if (data.r == 's') {
          $('#w2woutput').val(data.w);
        } else {
          $('#w2woutput').val('에러');
        }
        target.innerText = target.innerText.split(' 전송중...')[0];
      }
    });
  }

  function reset(target) {
    target.innerText += ' 전송중...';
    $.ajax({
      url: '/pf-reset',
      success: function(data){
        target.innerText = target.innerText.split(' 전송중...')[0];
      }
    });
  }
  </script>

  <input id='inputText' type="text">
  <button onclick="send(document.getElementById('inputText').value)"> Send</button><br>
  <button id='stage0button' onclick="send('stage:0')"> Stage 0 (mute) </button><br>
  <button onclick="send('stage:1')"> Stage 1 (slide) </button><br>
  <button onclick="send('stage:2')"> Stage 2 (all) </button><br>
  <input id='stage3number' type="number" value="0" step="1">
  <button onclick="send('stage:3:' + document.getElementById('stage3number').value)"> Stage 3 (one) </button><br>
  <button onclick="send('stage:4')"> Stage 4 (spectrum) </button><br>
  <button onclick="send('stage:5')"> Stage 5 (words) </button><br>
  <textarea id='wordsText' type='text' ></textarea>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('wordsText').value))"> Stage5에 적용 </button>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('wordsText').value)); send('stage:5');"> Stage5에 적용하고 스테이지5로 변경 </button> <br>
  <button onclick="updateImages(event.target)">사용자가 올린 이미지 가져오기</button><br>
  <div id='imagesDiv'></div><br>
  <button onclick="send('images:'+userImages.join(',')); send('scores:'+userScores.join(','));">사용자 올린 이미지를 퍼포먼스 페이지에 반영</button><br>
  <button onclick="send('rank:show');">랭킹 보이기</button>
  <button onclick="send('rank:hide');">랭킹 숨기기</button>
  <button onclick="reset(event.target)">이미지 리셋</button>
  <input id='tagNumber' type="number" value="0" step="1">
  <button onclick="getTags(event.target)"> 태그 가져오기 </button><br>
  <textarea id='tagsText' type='text' ></textarea>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('tagsText').value))"> Stage5에 적용 </button>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('tagsText').value)); send('stage:5')"> Stage5에 적용하고 스테이지5로 변경 </button> <br>
  <textarea id='captionText' type='text' ></textarea>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('captionText').value))"> Stage5에 적용 </button>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('captionText').value)); send('stage:5')"> Stage5에 적용하고 스테이지5로 변경 </button> <br>
  <textarea id='w2winput' type='text' ></textarea>
  <button onclick="w2w(event.target)"> 비슷한 단어 찾기</button>
  <textarea id='w2woutput' type='text' ></textarea>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('w2woutput').value))"> Stage5에 적용 </button>
  <button onclick="send('words:' + encodeURIComponent(document.getElementById('w2woutput').value)); send('stage:5')"> Stage5에 적용하고 스테이지5로 변경 </button> <br>
  <button onclick="send('ex:open');"> 새 창에서 전시 페이지 열기 </button><br>
  <button onclick="send('ex:close');"> 전시 페이지 닫기 </button><br>
</body>
</html>
